   
  <!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Responsive:contentReference[oaicite:12]{index=12} -->
  <title>CRM Webapp</title>
  <!-- Bootstrap CSS (từ CDN):contentReference[oaicite:13]{index=13} -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-4">
    <!-- Phần Navbar Tabs -->
    <ul class="nav nav-pills nav-fill mb-3" id="nav-tab" role="tablist">
      <li class="nav-item">
        <button class="nav-link active" id="nav-dashboard-tab" data-bs-toggle="pill" data-bs-target="#nav-dashboard" type="button" role="tab">Dashboard</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="nav-projects-tab" data-bs-toggle="pill" data-bs-target="#nav-projects" type="button" role="tab">Projects</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="nav-tasks-tab" data-bs-toggle="pill" data-bs-target="#nav-tasks" type="button" role="tab">Tasks</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="nav-weekly-tab" data-bs-toggle="pill" data-bs-target="#nav-weekly" type="button" role="tab">Weekly Reports</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="nav-customers-tab" data-bs-toggle="pill" data-bs-target="#nav-customers" type="button" role="tab">Customers</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="nav-users-tab" data-bs-toggle="pill" data-bs-target="#nav-users" type="button" role="tab">Users</button>
      </li>
    </ul>
    <div class="tab-content" id="nav-tabContent">
      <!-- Dashboard -->
      <div class="tab-pane fade show active" id="nav-dashboard" role="tabpanel">
        <h3>Dashboard</h3>
        <p>Chào mừng đến với hệ thống CRM. Ở đây có thể hiển thị các thông tin tổng quan như số lượng dự án, báo cáo tuần, v.v.</p>
      </div>
      
      <!-- Projects -->
      <div class="tab-pane fade" id="nav-projects" role="tabpanel">
        <h3>Projects</h3>
        <!-- Thông báo thành công khi thêm/sửa -->
        <div id="project-alert" class="alert alert-success alert-dismissible fade show d-none" role="alert">
          Thao tác thành công!
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <!-- Form thêm/sửa project -->
        <form id="project-form" class="row g-3 mb-3">
          <input type="hidden" id="project-id">
          <div class="col-md-4">
            <label for="project-name" class="form-label">Tên Project</label>
            <input type="text" class="form-control" id="project-name" required>
          </div>
          <div class="col-md-4">
            <label for="project-customer" class="form-label">Customer</label>
            <select id="project-customer" class="form-select" required>
              <option value="">-- Chọn customer --</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="project-desc" class="form-label">Mô tả</label>
            <input type="text" class="form-control" id="project-desc">
          </div>
          <div class="col-md-3">
            <label for="project-start" class="form-label">Ngày bắt đầu</label>
            <input type="date" class="form-control" id="project-start">
          </div>
          <div class="col-md-3">
            <label for="project-end" class="form-label">Ngày kết thúc</label>
            <input type="date" class="form-control" id="project-end">
          </div>
          <div class="col-md-12">
            <button type="submit" class="btn btn-primary" id="project-save-btn">Thêm Project</button>
            <button type="button" class="btn btn-secondary d-none" id="project-cancel-btn">Hủy</button>
          </div>
        </form>
        <!-- Bảng danh sách projects -->
        <table class="table table-bordered table-striped">
          <thead><tr><th>ID</th><th>Name</th><th>Customer</th><th>Mô tả</th><th>Thao tác</th></tr></thead>
          <tbody id="projects-table-body"></tbody>
        </table>
      </div>

      <!-- Tasks -->
      <div class="tab-pane fade" id="nav-tasks" role="tabpanel">
        <h3>Tasks</h3>
        <div id="task-alert" class="alert alert-success alert-dismissible fade show d-none" role="alert">
          Thao tác thành công!
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <form id="task-form" class="row g-3 mb-3">
          <input type="hidden" id="task-id">
          <div class="col-md-4">
            <label for="task-title" class="form-label">Tiêu đề Task</label>
            <input type="text" class="form-control" id="task-title" required>
          </div>
          <div class="col-md-4">
            <label for="task-project" class="form-label">Project</label>
            <select id="task-project" class="form-select" required>
              <option value="">-- Chọn project --</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="task-user" class="form-label">Assigned User</label>
            <select id="task-user" class="form-select" required>
              <option value="">-- Chọn user --</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="task-due" class="form-label">Due Date</label>
            <input type="date" class="form-control" id="task-due">
          </div>
          <div class="col-md-2">
            <label for="task-status" class="form-label">Status</label>
            <select id="task-status" class="form-select">
              <option value="Pending">Pending</option>
              <option value="InProgress">InProgress</option>
              <option value="Done">Done</option>
            </select>
          </div>
          <div class="col-md-12">
            <button type="submit" class="btn btn-primary" id="task-save-btn">Thêm Task</button>
            <button type="button" class="btn btn-secondary d-none" id="task-cancel-btn">Hủy</button>
          </div>
        </form>
        <table class="table table-bordered table-striped">
          <thead><tr><th>ID</th><th>Tiêu đề</th><th>Project</th><th>User</th><th>Due Date</th><th>Status</th><th>Thao tác</th></tr></thead>
          <tbody id="tasks-table-body"></tbody>
        </table>
      </div>

      <!-- Weekly Reports -->
      <div class="tab-pane fade" id="nav-weekly" role="tabpanel">
        <h3>Weekly Reports</h3>
        <div id="weekly-alert" class="alert alert-success alert-dismissible fade show d-none" role="alert">
          Thao tác thành công!
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <form id="weekly-form" class="row g-3 mb-3">
          <input type="hidden" id="weekly-id">
          <div class="col-md-4">
            <label for="weekly-project" class="form-label">Project</label>
            <select id="weekly-project" class="form-select" required>
              <option value="">-- Chọn project --</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="week-start" class="form-label">Tuần từ (ngày)</label>
            <input type="date" class="form-control" id="week-start" required>
          </div>
          <div class="col-md-3">
            <label for="week-end" class="form-label">Đến (ngày)</label>
            <input type="date" class="form-control" id="week-end" required>
          </div>
          <div class="col-md-12">
            <label for="weekly-summary" class="form-label">Tóm tắt công việc</label>
            <textarea class="form-control" id="weekly-summary" rows="2"></textarea>
          </div>
          <div class="col-md-12">
            <button type="submit" class="btn btn-primary" id="weekly-save-btn">Thêm Báo cáo tuần</button>
            <button type="button" class="btn btn-secondary d-none" id="weekly-cancel-btn">Hủy</button>
          </div>
        </form>
        <table class="table table-bordered table-striped">
          <thead><tr><th>ID</th><th>Project</th><th>Start</th><th>End</th><th>Tóm tắt</th><th>Thao tác</th></tr></thead>
          <tbody id="weekly-table-body"></tbody>
        </table>
      </div>

      <!-- Customers -->
      <div class="tab-pane fade" id="nav-customers" role="tabpanel">
        <h3>Customers</h3>
        <div id="customer-alert" class="alert alert-success alert-dismissible fade show d-none" role="alert">
          Thao tác thành công!
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <form id="customer-form" class="row g-3 mb-3">
          <input type="hidden" id="customer-id">
          <div class="col-md-4">
            <label for="customer-name" class="form-label">Tên KH</label>
            <input type="text" class="form-control" id="customer-name" required>
          </div>
          <div class="col-md-4">
            <label for="customer-email" class="form-label">Email</label>
            <input type="email" class="form-control" id="customer-email">
          </div>
          <div class="col-md-4">
            <label for="customer-phone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="customer-phone">
          </div>
          <div class="col-md-12">
            <button type="submit" class="btn btn-primary" id="customer-save-btn">Thêm Customer</button>
            <button type="button" class="btn btn-secondary d-none" id="customer-cancel-btn">Hủy</button>
          </div>
        </form>
        <table class="table table-bordered table-striped">
          <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Thao tác</th></tr></thead>
          <tbody id="customers-table-body"></tbody>
        </table>
      </div>

      <!-- Users -->
      <div class="tab-pane fade" id="nav-users" role="tabpanel">
        <h3>Users (Admin Only)</h3>
        <div id="user-alert" class="alert alert-success alert-dismissible fade show d-none" role="alert">
          Thao tác thành công!
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <form id="user-form" class="row g-3 mb-3">
          <input type="hidden" id="user-id">
          <div class="col-md-4">
            <label for="user-name" class="form-label">Tên User</label>
            <input type="text" class="form-control" id="user-name" required>
          </div>
          <div class="col-md-4">
            <label for="user-email" class="form-label">Email</label>
            <input type="email" class="form-control" id="user-email" required>
          </div>
          <div class="col-md-4">
            <label for="user-role" class="form-label">Role</label>
            <select id="user-role" class="form-select" required>
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="col-md-12">
            <button type="submit" class="btn btn-primary" id="user-save-btn">Thêm User</button>
            <button type="button" class="btn btn-secondary d-none" id="user-cancel-btn">Hủy</button>
          </div>
        </form>
        <table class="table table-bordered table-striped">
          <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Thao tác</th></tr></thead>
          <tbody id="users-table-body"></tbody>
        </table>
      </div>

    </div> <!-- end tab-content -->
  </div> <!-- end container -->

  <!-- Bootstrap JS Bundle (từ CDN):contentReference[oaicite:14]{index=14} -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Supabase JS (từ CDN):contentReference[oaicite:15]{index=15} -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // Khởi tạo Supabase client:contentReference[oaicite:16]{index=16}
   const DATA_URL         = 'https://hziwyxbwqcdittvlhijo.supabase.co';
    const DATA_ANON_KEY    = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6aXd5eGJ3cWNkaXR0dmxoaWpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4ODE0MTksImV4cCI6MjA2OTQ1NzQxOX0.7kFGMEOX23Lg3b4imPalbju8G4yHyReuWBVoXVmvxEA';


    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    // Hàm tải dữ liệu customers và điền vào bảng + chọn Project Form
    async function loadCustomers() {
      let { data, error } = await supabaseClient.from('customers').select().order('id');
      if (error) { console.error(error); return; }
      const tbody = document.getElementById('customers-table-body');
      tbody.innerHTML = '';
      data.forEach(c => {
        tbody.innerHTML += `
          <tr>
            <td>${c.id}</td><td>${c.name}</td><td>${c.email}</td><td>${c.phone}</td>
            <td>
              <button class="btn btn-sm btn-primary" onclick="editCustomer(${c.id}, '${c.name}', '${c.email}', '${c.phone}')">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${c.id})">Delete</button>
            </td>
          </tr>`;
      });
      // Cập nhật dropdown Project nếu cần
    }

    // Tương tự: loadProjects(), loadTasks(), loadWeeklyReports(), loadUsers()
    // (Các hàm này sẽ giống mẫu trên: supabase.from(...).select(), rồi render vào bảng và cập nhật các <select> khi cần)

    // Event listeners cho form submit (ví dụ add/sửa customer)
    document.getElementById('customer-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const id = document.getElementById('customer-id').value;
      const name = document.getElementById('customer-name').value;
      const email = document.getElementById('customer-email').value;
      const phone = document.getElementById('customer-phone').value;
      if (id) {
        // Update
        await supabaseClient.from('customers').update({ name, email, phone }).eq('id', id);
      } else {
        // Insert mới
        await supabaseClient.from('customers').insert({ name, email, phone });
      }
      // Hiển thị alert thành công
      document.getElementById('customer-alert').classList.remove('d-none');
      // Reset form và reload bảng
      document.getElementById('customer-form').reset();
      document.getElementById('customer-id').value = '';
      document.getElementById('customer-cancel-btn').classList.add('d-none');
      loadCustomers();
    });
    document.getElementById('customer-cancel-btn').addEventListener('click', function() {
      document.getElementById('customer-form').reset();
      document.getElementById('customer-id').value = '';
      this.classList.add('d-none');
      document.getElementById('customer-save-btn').innerText = 'Thêm Customer';
    });

    function editCustomer(id, name, email, phone) {
      document.getElementById('customer-id').value = id;
      document.getElementById('customer-name').value = name;
      document.getElementById('customer-email').value = email;
      document.getElementById('customer-phone').value = phone;
      document.getElementById('customer-save-btn').innerText = 'Cập nhật';
      document.getElementById('customer-cancel-btn').classList.remove('d-none');
    }
    async function deleteCustomer(id) {
      if (confirm('Chắc chắn xoá customer này?')) {
        await supabaseClient.from('customers').delete().eq('id', id);
        loadCustomers();
      }
    }

    // Các hàm tương tự cho Projects, Tasks, Weekly Reports, Users...

    // Khởi tạo khi trang load
    document.addEventListener('DOMContentLoaded', () => {
      loadCustomers();
      // gọi loadProjects(), loadTasks(), loadWeeklyReports(), loadUsers()
    });
  </script>
</body>
</html>
